"""
ุงุฎุชุจุงุฑ ูุถุน ุงููุญุงูุงุฉ ุงููุญุณู ูุฎุฏูุฉ Gemini
Test the improved mock mode for Gemini service
"""

import os
import asyncio
import sys
from pathlib import Path

# Add the app directory to the Python path
sys.path.append(str(Path(__file__).parent))

# Force mock mode by removing API key
if 'GEMINI_API_KEY' in os.environ:
    del os.environ['GEMINI_API_KEY']

from app.services.gemini_service import GeminiService


async def test_mock_mode_improvements():
    """ุงุฎุชุจุงุฑ ุงูุชุญุณููุงุช ูู ูุถุน ุงููุญุงูุงุฉ"""
    
    print("๐ญ ุงุฎุชุจุงุฑ ูุถุน ุงููุญุงูุงุฉ ุงููุญุณู ูุฎุฏูุฉ Gemini\n")
    
    # ุฅูุดุงุก ุงูุฎุฏูุฉ (ูู ูุถุน ุงููุญุงูุงุฉ)
    service = GeminiService()
    
    # ูุญุต ุงูุญุงูุฉ
    print("1๏ธโฃ ูุญุต ุญุงูุฉ Gemini:")
    health = await service.health_check()
    print(f"   ุงูุญุงูุฉ: {health['status']}")
    print(f"   ุงููุถุน: {health.get('mode', 'unknown')}")
    print(f"   ูุถุน ุงููุญุงูุงุฉ: {service.mock_mode}")
    print()
    
    # ุงุฎุชุจุงุฑ ุงููุตูุต ุงููุชุทุงุจูุฉ (ูุซู ุงูุตูุฑ ุงููุฑููุฉ)
    print("2๏ธโฃ ุงุฎุชุจุงุฑ ุงููุตูุต ุงููุชุทุงุจูุฉ:")
    identical_text = """ูุงุนุฏุฉ (ูุจุฏุฃ) ุจุงุณูุงู
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก.

ุชุทุจููุงุช ุนูู ูุงุนุฏุฉ ุจุงุณูุงู:
- ุงูููุจุณ ุงูููุฏุฑููููู
- ุงููุฑุงูู ุงูููุฏุฑูููููุฉ ููุณูุงุฑุฉ
- ุงูุฑุงูุนุฉ ุงูููุฏุฑูููููุฉ"""
    
    result1 = await service.compare_texts(identical_text, identical_text)
    print(f"   ุงููุตุงู ูุชุทุงุจูุงู 100%:")
    print(f"   ูุณุจุฉ ุงูุชุดุงุจู: {result1.similarity_percentage}%")
    print(f"   ุงูููุฎุต: {result1.summary}")
    print(f"   ุงูุชูุตูุฉ: {result1.recommendation}")
    print(f"   ุงูุซูุฉ: {result1.confidence_score}")
    print()
    
    # ุงุฎุชุจุงุฑ ูุตูุต ูุชุดุงุจูุฉ ูุน ุงุฎุชูุงูุงุช ุทูููุฉ
    print("3๏ธโฃ ุงุฎุชุจุงุฑ ุงููุตูุต ุงููุชุดุงุจูุฉ ูุน ุงุฎุชูุงูุงุช ุทูููุฉ:")
    text_old = """ูุงุนุฏุฉ (ูุจุฏุฃ) ุจุงุณูุงู
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก."""
    
    text_new = """ูุงุนุฏุฉ ุจุงุณูุงู  
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก."""
    
    result2 = await service.compare_texts(text_old, text_new)
    print(f"   ูุต ูุน ุงุฎุชูุงู ุทููู:")
    print(f"   ูุณุจุฉ ุงูุชุดุงุจู: {result2.similarity_percentage}%")
    print(f"   ุงูููุฎุต: {result2.summary}")
    print(f"   ุงูุชูุตูุฉ: {result2.recommendation}")
    print(f"   ุงูุซูุฉ: {result2.confidence_score}")
    print()
    
    # ุงุฎุชุจุงุฑ ุงููุต ุงููุนูู ูู ุงูุชูุฑูุฑ 
    print("4๏ธโฃ ุงุฎุชุจุงุฑ ุงููุต ุงููุนูู ูู ุงูุตูุฑ ุงููุฑููุฉ:")
    old_from_images = """ูุงู ุงูุนุงูู ุงููุฑูุณู ุจุงุณูุงู ุจุตูุงุบุฉ ูุฐู ุงููุชูุฌุฉ ููุง ููู :
ูุงุนุฏุฉ (ูุจุฏุฃ) ุจุงุณูุงู
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก.
ููุงุญุธุฉ
* ุชุฎุถุน ุงูุณูุงุฆู ููุงุนุฏุฉ ุจุงุณูุงู ุจูููุง ูุง ุชุฎุถุน ุงูุบุงุฒุงุช ููุง.
ุชุทุจููุงุช ุนูู ูุงุนุฏุฉ ุจุงุณูุงู
ุงูููุจุณ ุงูููุฏุฑููููู
ุงููุฑุงูู ุงูููุฏุฑูููููุฉ ููุณูุงุฑุฉ  
ุงูุฑุงูุนุฉ ุงูููุฏุฑูููููุฉ
ุงูุญูุงุฑ ุงูููุฏุฑููููู
ูุฑุณู ุทุจูุจ ุงูุฃุณูุงู"""
    
    new_from_images = """* ูุงู ุงูุนุงูู ุงููุฑูุณู ุจุงุณูุงู ุจุตูุงุบุฉ ูุฐู ุงููุชูุฌุฉ ููุง ููู :
ูุงุนุฏุฉ (ูุจุฏุฃ) ุจุงุณูุงู
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก.
ููุงุญุธุฉ
ุชุฎุถุน ุงูุณูุงุฆู ููุงุนุฏุฉ ุจุงุณูุงู ุจูููุง ูุง ุชุฎุถุน ุงูุบุงุฒุงุช ููุงุ
ุชุทุจููุงุช ุนูู ูุงุนุฏุฉ ุจุงุณูุงู
ุงูููุจุณ ุงูููุฏุฑููููู
ุงููุฑุงูู ุงูููุฏุฑูููููุฉ ููุณูุงุฑุฉ
ุงูุฑุงูุนุฉ ุงูููุฏุฑูููููุฉ  
ุงูุญูุงุฑ ุงูููุฏุฑููููู
ูุฑุณู ุทุจูุจ ุงูุฃุณูุงู"""
    
    result3 = await service.compare_texts(old_from_images, new_from_images)
    print(f"   ุงููุต ุงููุนูู ูู ุงูุตูุฑ ุงููุฑููุฉ:")
    print(f"   ูุณุจุฉ ุงูุชุดุงุจู: {result3.similarity_percentage}%")
    print(f"   ุงูููุฎุต: {result3.summary}")
    print(f"   ุงูุชูุตูุฉ: {result3.recommendation}")
    print(f"   ุงูุซูุฉ: {result3.confidence_score}")
    print(f"   ุงูุชุบููุฑุงุช ุงููุญุชูู: {len(result3.content_changes)}")
    print(f"   ุงูุงุฎุชูุงูุงุช ุงูุฌููุฑูุฉ: {len(result3.major_differences)}")
    print()
    
    print("โ ุงูุชูู ุงุฎุชุจุงุฑ ูุถุน ุงููุญุงูุงุฉ ุงููุญุณู!")
    print(f"๐ ููุฎุต ุงููุชุงุฆุฌ:")
    print(f"   - ุงููุตูุต ุงููุชุทุงุจูุฉ: {result1.similarity_percentage}% โ")
    print(f"   - ุงููุตูุต ุงููุชุดุงุจูุฉ: {result2.similarity_percentage}% โ")
    print(f"   - ุงููุต ุงููุนูู ูู ุงูุตูุฑ: {result3.similarity_percentage}% โ")
    
    # ุชูููู ุงูุชุญุณููุงุช
    print(f"\n๐ฏ ุชูููู ุงูุชุญุณููุงุช:")
    if result1.similarity_percentage >= 95:
        print(f"   โ ุงููุตูุต ุงููุชุทุงุจูุฉ: ููุชุงุฒ ({result1.similarity_percentage}%)")
    if result2.similarity_percentage >= 90:
        print(f"   โ ุงููุตูุต ุงููุชุดุงุจูุฉ: ููุชุงุฒ ({result2.similarity_percentage}%)")
    if result3.similarity_percentage >= 85:
        print(f"   โ ุงููุต ุงููุนูู: ููุชุงุฒ ({result3.similarity_percentage}%)")
    
    print(f"\n๐ ููุงุฑูุฉ ูุน ุงููุชุงุฆุฌ ุงูุณุงุจูุฉ:")
    print(f"   - ูุจู ุงูุชุญุณูู: 41.3% ู 16.8% (ุบูุฑ ุฏููู)")
    print(f"   - ุจุนุฏ ุงูุชุญุณูู: {result3.similarity_percentage}% (ุฏููู ููุชูุงูู ูุน ุงููุงูุน)")


if __name__ == "__main__":
    asyncio.run(test_mock_mode_improvements()) 