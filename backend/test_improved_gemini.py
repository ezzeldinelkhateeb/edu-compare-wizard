"""
ุงุฎุชุจุงุฑ ุงููุธุงู ุงููุญุณู ูุฎุฏูุฉ Gemini ูุญุณุงุจ ุงูุชุดุงุจู
Test the improved Gemini service and similarity calculation
"""

import os
import asyncio
import sys
from pathlib import Path

# Add the app directory to the Python path
sys.path.append(str(Path(__file__).parent))

# Set environment variable
os.environ['GEMINI_API_KEY'] = 'AIzaSyCDO-0puQQN79BJ4u503O31g16ww8CAycg'

from app.services.gemini_service import GeminiService


async def test_gemini_improvements():
    """ุงุฎุชุจุงุฑ ุงูุชุญุณููุงุช ุนูู ุฎุฏูุฉ Gemini"""
    
    print("๐ง ุงุฎุชุจุงุฑ ุงููุธุงู ุงููุญุณู ูุฎุฏูุฉ Gemini\n")
    
    # ุฅูุดุงุก ุงูุฎุฏูุฉ
    service = GeminiService()
    
    # ูุญุต ุงูุญุงูุฉ
    print("1๏ธโฃ ูุญุต ุญุงูุฉ Gemini:")
    health = await service.health_check()
    print(f"   ุงูุญุงูุฉ: {health['status']}")
    print(f"   ุงููุถุน: {health.get('mode', 'unknown')}")
    print(f"   ููุชุงุญ API: {'ููุฌูุฏ' if health.get('api_key_configured', False) else 'ุบูุฑ ููุฌูุฏ'}")
    print()
    
    # ุงุฎุชุจุงุฑ ุงููุตูุต ุงููุชุทุงุจูุฉ (ูุซู ุงูุตูุฑ ุงููุฑููุฉ)
    print("2๏ธโฃ ุงุฎุชุจุงุฑ ุงููุตูุต ุงููุชุทุงุจูุฉ:")
    identical_text = """ูุงุนุฏุฉ (ูุจุฏุฃ) ุจุงุณูุงู
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก.

ุชุทุจููุงุช ุนูู ูุงุนุฏุฉ ุจุงุณูุงู:
- ุงูููุจุณ ุงูููุฏุฑููููู
- ุงููุฑุงูู ุงูููุฏุฑูููููุฉ ููุณูุงุฑุฉ
- ุงูุฑุงูุนุฉ ุงูููุฏุฑูููููุฉ"""
    
    result1 = await service.compare_texts(identical_text, identical_text)
    print(f"   ุงููุตุงู ูุชุทุงุจูุงู 100%:")
    print(f"   ูุณุจุฉ ุงูุชุดุงุจู: {result1.similarity_percentage}%")
    print(f"   ุงูููุฎุต: {result1.summary}")
    print(f"   ุงูุชูุตูุฉ: {result1.recommendation}")
    print()
    
    # ุงุฎุชุจุงุฑ ูุตูุต ูุชุดุงุจูุฉ ูุน ุงุฎุชูุงูุงุช ุทูููุฉ
    print("3๏ธโฃ ุงุฎุชุจุงุฑ ุงููุตูุต ุงููุชุดุงุจูุฉ ูุน ุงุฎุชูุงูุงุช ุทูููุฉ:")
    text_old = """ูุงุนุฏุฉ (ูุจุฏุฃ) ุจุงุณูุงู
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก."""
    
    text_new = """ูุงุนุฏุฉ ุจุงุณูุงู
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก."""
    
    result2 = await service.compare_texts(text_old, text_new)
    print(f"   ูุต ูุน ุงุฎุชูุงู ุทููู:")
    print(f"   ูุณุจุฉ ุงูุชุดุงุจู: {result2.similarity_percentage}%")
    print(f"   ุงูููุฎุต: {result2.summary}")
    print(f"   ุงูุชูุตูุฉ: {result2.recommendation}")
    print()
    
    # ุงุฎุชุจุงุฑ ูุตูุต ูุฎุชููุฉ
    print("4๏ธโฃ ุงุฎุชุจุงุฑ ุงููุตูุต ุงููุฎุชููุฉ:")
    different_text = """ููุงููู ูููุชู ููุญุฑูุฉ
ุงููุงููู ุงูุฃูู: ุงูุฌุณู ุงูุณุงูู ูุจูู ุณุงููุงู ูุงูุฌุณู ุงููุชุญุฑู ูุจูู ูุชุญุฑูุงู ูุง ูู ุชุคุซุฑ ุนููู ููุฉ ุฎุงุฑุฌูุฉ."""
    
    result3 = await service.compare_texts(text_old, different_text)
    print(f"   ูุตุงู ูุฎุชููุงู:")
    print(f"   ูุณุจุฉ ุงูุชุดุงุจู: {result3.similarity_percentage}%")
    print(f"   ุงูููุฎุต: {result3.summary}")
    print(f"   ุงูุชูุตูุฉ: {result3.recommendation}")
    print()
    
    # ุงุฎุชุจุงุฑ ุงููุต ูู ุงูุชูุฑูุฑ ุงููุนูู
    print("5๏ธโฃ ุงุฎุชุจุงุฑ ุงููุต ุงููุนูู ูู ุงูุชูุฑูุฑ:")
    old_from_report = """ูุงู ุงูุนุงูู ุงููุฑูุณู ุจุงุณูุงู ุจุตูุงุบุฉ ูุฐู ุงููุชูุฌุฉ ููุง ููู :
ูุงุนุฏุฉ (ูุจุฏุฃ) ุจุงุณูุงู
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก.
ููุงุญุธุฉ
* ุชุฎุถุน ุงูุณูุงุฆู ููุงุนุฏุฉ ุจุงุณูุงู ุจูููุง ูุง ุชุฎุถุน ุงูุบุงุฒุงุช ููุง."""
    
    new_from_report = """* ูุงู ุงูุนุงูู ุงููุฑูุณู ุจุงุณูุงู ุจุตูุงุบุฉ ูุฐู ุงููุชูุฌุฉ ููุง ููู :
ูุงุนุฏุฉ (ูุจุฏุฃ) ุจุงุณูุงู
ุนูุฏูุง ูุคุซุฑ ุถุบุท ุนูู ุณุงุฆู ูุญุจูุณ ูู ุฅูุงุกุ ูุฅู ุฐูู ุงูุถุบุท ููุชูู ุจุชูุงูู ุฅูู ุฌููุน ุฃุฌุฒุงุก ุงูุณุงุฆู ููุง ููุชูู ุฅูู ุฌุฏุฑุงู ุงูุฅูุงุก.
ููุงุญุธุฉ
ุชุฎุถุน ุงูุณูุงุฆู ููุงุนุฏุฉ ุจุงุณูุงู ุจูููุง ูุง ุชุฎุถุน ุงูุบุงุฒุงุช ููุงุ"""
    
    result4 = await service.compare_texts(old_from_report, new_from_report)
    print(f"   ุงููุต ุงููุนูู ูู ุงูุชูุฑูุฑ:")
    print(f"   ูุณุจุฉ ุงูุชุดุงุจู: {result4.similarity_percentage}%")
    print(f"   ุงูููุฎุต: {result4.summary}")
    print(f"   ุงูุชูุตูุฉ: {result4.recommendation}")
    print()
    
    print("โ ุงูุชูู ุงูุงุฎุชุจุงุฑ!")
    print(f"๐ ููุฎุต ุงููุชุงุฆุฌ:")
    print(f"   - ุงููุตูุต ุงููุชุทุงุจูุฉ: {result1.similarity_percentage}%")
    print(f"   - ุงููุตูุต ุงููุชุดุงุจูุฉ: {result2.similarity_percentage}%") 
    print(f"   - ุงููุตูุต ุงููุฎุชููุฉ: {result3.similarity_percentage}%")
    print(f"   - ุงููุต ุงููุนูู: {result4.similarity_percentage}%")


if __name__ == "__main__":
    asyncio.run(test_gemini_improvements()) 