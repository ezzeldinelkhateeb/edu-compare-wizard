# دليل المقارنة الذكية للكتب الدراسية 📚

## نظرة عامة

تم تطوير نظام متقدم لمقارنة الكتب الدراسية باستخدام تقنيات الذكاء الاصطناعي المتطورة. يوفر النظام خيارين للمعالجة مع تحسين التكلفة والدقة.

## 🚀 الميزات الجديدة

### 1. خيارات المعالجة المتقدمة

#### أ) وضع Gemini فقط 🧠
- **الوصف**: يستخدم Gemini Vision API مباشرة لاستخراج النص والمقارنة في خطوة واحدة
- **المزايا**: 
  - أسرع في المعالجة
  - أقل تكلفة (استدعاء API واحد)
  - مناسب للمقارنات السريعة
- **الاستخدام المُوصى به**: الكتب ذات النصوص البسيطة والواضحة

#### ب) وضع LandingAI + Gemini 🔧
- **الوصف**: يستخدم LandingAI لاستخراج النص بدقة عالية، ثم Gemini للمقارنة والتحليل
- **المزايا**:
  - دقة أعلى في استخراج النص
  - أفضل للنصوص المعقدة والجداول
  - تحليل أكثر تفصيلاً
- **الاستخدام المُوصى به**: الكتب ذات النصوص المعقدة، الجداول، والمعادلات

### 2. عتبة المقارنة البصرية 👁️

- **النطاق**: 50% - 100%
- **الافتراضي**: 85%
- **الوظيفة**: إذا كان التشابه البصري أعلى من العتبة، يتم توفير المعالجة النصية
- **التوفير**: يمكن توفير حتى 100% من تكلفة API للصور المتطابقة بصرياً

## 📋 كيفية الاستخدام

### الخطوة 1: رفع الملفات
1. اختر الملفات للمنهج القديم والجديد
2. يمكنك رفع:
   - ملفات فردية (JPG, PNG, PDF)
   - مجلدات كاملة
   - حتى 100 ملف لكل منهج

### الخطوة 2: اختيار إعدادات المعالجة

#### اختيار طريقة المعالجة:
```
🔘 LandingAI + Gemini (دقة أعلى)
🔘 Gemini فقط (أسرع وأقل تكلفة)
```

#### ضبط العتبة البصرية:
```
50% ←→ 85% ←→ 100%
حساسية عالية    حساسية منخفضة
```

### الخطوة 3: بدء المقارنة
انقر على "ابدأ المقارنة الذكية" وسيقوم النظام بـ:
1. **المقارنة البصرية السريعة** أولاً
2. **توفير المعالجة** إذا كان التشابه عالياً
3. **المعالجة النصية** حسب الوضع المختار

## 🔧 التفاصيل التقنية

### خدمة Gemini Vision الجديدة

```python
# مثال على استخدام خدمة Gemini Vision
from app.services.gemini_vision_service import gemini_vision_service

# استخراج النص من صورة واحدة
result = await gemini_vision_service.extract_text_from_image(image_path)

# مقارنة صورتين مباشرة
comparison = await gemini_vision_service.compare_images_directly(
    old_image_path, new_image_path
)
```

### API Endpoint المحدث

```http
POST /api/compare/full-comparison/{session_id}
Content-Type: application/json

{
  "processing_mode": "gemini_only",  // أو "landingai_gemini"
  "visual_threshold": 85.0
}
```

### استجابة API المحسنة

```json
{
  "session_id": "abc123",
  "status": "completed",
  "processing_mode": "gemini_only",
  "visual_threshold": 85.0,
  "api_calls_saved": 1,
  "summary": {
    "cost_optimization": "تم توفير 1 استدعاء API"
  }
}
```

## 💰 تحسين التكلفة

### السيناريوهات المختلفة:

#### 1. صور متطابقة بصرياً (≥85% تشابه)
- **التوفير**: 100% من تكلفة المعالجة النصية
- **الوقت**: ثوانٍ قليلة فقط
- **النتيجة**: تقرير بصري سريع

#### 2. وضع Gemini فقط
- **التوفير**: 50% مقارنة بالوضع التقليدي
- **الوقت**: متوسط
- **النتيجة**: مقارنة مباشرة وسريعة

#### 3. وضع LandingAI + Gemini
- **التوفير**: 0% (الوضع الكامل)
- **الوقت**: أطول
- **النتيجة**: أعلى دقة ممكنة

## 🎯 نصائح للاستخدام الأمثل

### للحصول على أفضل النتائج:

1. **للكتب البسيطة**: استخدم وضع "Gemini فقط"
2. **للكتب المعقدة**: استخدم وضع "LandingAI + Gemini"
3. **للمقارنات السريعة**: ارفع العتبة البصرية إلى 90%+
4. **للدقة العالية**: اخفض العتبة البصرية إلى 70%

### تحسين الأداء:

- **رفع الملفات**: استخدم مجلدات بدلاً من الملفات الفردية
- **جودة الصور**: استخدم صور عالية الجودة (300 DPI+)
- **حجم الملف**: تجنب الملفات الكبيرة جداً (>10MB)

## 📊 مراقبة الأداء

### مؤشرات الأداء المعروضة:

- **عدد الملفات المعالجة**
- **الوقت المستغرق**
- **نسبة التوفير في التكلفة**
- **دقة المقارنة**

### السجلات والتقارير:

- **سجل المعالجة**: تفاصيل كل خطوة
- **تقرير التوفير**: مقدار التوفير المحقق
- **تحليل الأداء**: إحصائيات مفصلة

## 🔍 استكشاف الأخطاء

### المشاكل الشائعة:

#### 1. "فشل في استخراج النص"
- **الحل**: جرب الوضع الآخر
- **السبب**: جودة الصورة منخفضة

#### 2. "تجاوز حد API"
- **الحل**: انتظر أو ارفع العتبة البصرية
- **السبب**: استخدام مكثف للـ API

#### 3. "نتائج غير دقيقة"
- **الحل**: استخدم وضع "LandingAI + Gemini"
- **السبب**: النص معقد أو يحتوي على جداول

## 🔄 التحديثات المستقبلية

### قيد التطوير:

- **دعم المزيد من اللغات**
- **مقارنة أكثر من كتابين**
- **تحليل الجداول والمعادلات**
- **تصدير التقارير بصيغ متعددة**

---

## 📞 الدعم الفني

للحصول على المساعدة:
- راجع هذا الدليل أولاً
- تحقق من سجل الأخطاء
- تواصل مع فريق الدعم

---

*تم تحديث هذا الدليل في: يناير 2025* 